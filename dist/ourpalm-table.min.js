!function(e){function t(n){if(a[n])return a[n].exports;var o=a[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){a(1),e.exports=a(2)},function(e,t){"use strict";!function(e,t){Array.prototype.copy=function(e,t){return[].concat(this).slice(e,t)},e.module("ourpalm-table",[]).provider("ourpalmTable",function(){var t={column:{header:"",field:"",sort:!1,sortOrder:"asc",checkbox:!1,rownumbers:!1,show:!0},serverSort:!0,serverLoad:!0,pagination:!0,singleSelect:!1,pageList:[10,20,30,40,50],defaultPageSize:10,skipPage:!0,cacheKey:"",cachePageSize:!1,cacheColumns:!1};this.setOptions=function(a){e.extend(t,a,!0)},this.$get=function(){return{options:t}}}).factory("OurpalmTable",["$timeout",function(t){function a(t){var a=this,n={allBoxChecked:!1,pageSize:10,currentPage:1,pageList:[10,20,30,50,100],total:0,rows:[],columns:[],pagination:!0,serverLoad:!0,serverSort:!0,singleSelect:!1,skipPage:!0,allPage:1,cacheKey:"",cachePageSize:!1,cacheColumns:!1},o=[];a.getOptions=function(){return{currentPage:n.currentPage,pageSize:n.pageSize}},a.getSelectedRows=function(){var t=[];return e.forEach(n.rows,function(e){e.__checked__&&t.push(e)}),t},a.getDisplayedRows=function(){return n.rows},a.getSortColumns=function(){var t=[];return e.forEach(n.columns,function(e){e.sort&&t.push(e)}),t},a.getDisplayedColumns=function(){var t=[];return e.forEach(n.columns,function(e){e.show&&t.push(e)}),t},a.reload=function(){S()};var r=function(a,o){e.extend(n,a,o,t)},l=function(){n.currentPage=1,n.pageSize=n.defaultPageSize||n.pageList[0],c()},c=function(){n.serverLoad?n.loadData&&n.loadData(a,d):p()},i=function(){if(window.localStorage&&n.cacheKey&&n.cacheColumns){var t=[n.cacheKey,"columns"].join("-"),a=window.localStorage.getItem(t);if(void 0!=a){var o=e.fromJson(a);e.forEach(n.columns,function(e,t){var a=e.field||"column"+t;void 0!=o[a]&&(e.show=o[a])})}else{var o={};e.forEach(n.columns,function(e,t){var a=e.field||"column"+t;o[a]=e.show}),window.localStorage.setItem(t,JSON.stringify(o))}}},s=function(){if(window.localStorage&&n.cacheKey&&n.cachePageSize){var e=[n.cacheKey,"pageSize"].join("-"),t=window.localStorage.getItem(e);void 0!=t?(t=parseInt(t),n.pageSize=n.defaultPageSize=t):(t=n.defaultPageSize||n.pageList[0],window.localStorage.setItem(e,t))}},u=function(){if(window.localStorage&&n.cacheKey&&n.cachePageSize){var e=[n.cacheKey,"pageSize"].join("-");window.localStorage.setItem(e,n.pageSize)}},g=function(){if(window.localStorage&&n.cacheKey&&n.cacheColumns){var t=[n.cacheKey,"columns"].join("-"),a={};e.forEach(n.columns,function(e,t){var n=e.field||"column"+t;a[n]=e.show}),window.localStorage.setItem(t,JSON.stringify(a))}},p=function(){n.total=n.data.length;var e=(n.currentPage-1)*n.pageSize,t=e+n.pageSize>n.total?n.total:e+n.pageSize;n.rows=n.data.copy(e,t),n.allPage=n.total%n.pageSize==0?n.total/n.pageSize:parseInt(n.total/n.pageSize+1),n.allBoxChecked=!1,h();for(var a=0;a<o.length;a++)o[a]()},d=function(e){n.total=e.total,n.rows=e.rows,n.allPage=n.total%n.pageSize==0?n.total/n.pageSize:parseInt(n.total/n.pageSize+1),n.allBoxChecked=!1,h();for(var t=0;t<o.length;t++)o[t]()},f=function(e){o.push(e)},h=function(){n.singleSelect?n.allBoxChecked||e.forEach(n.rows,function(e){e.__checked__=n.allBoxChecked}):e.forEach(n.rows,function(e){e.__checked__=n.allBoxChecked})},b=function(t){n.singleSelect&&(e.forEach(n.rows,function(e){e.__checked__=!1}),t.__checked__=!0)},m=function(){n.currentPage=1,c()},x=function(){n.currentPage=n.currentPage-1,c()},w=function(){n.currentPage=n.currentPage+1,c()},v=function(){n.currentPage=n.allPage,c()},P=function(e){var t=window.event?e.keyCode:e.which;if(13==t){var a=e.currentTarget.value;a&&n.skipPage&&(a=parseInt(a),a>=1&&a<=n.allPage&&(n.currentPage=a,c()))}},S=function(){c()},k=function(){n.currentPage=1,u(),c()},C=function(e,t){switch(e.sortOrder){case"asc":e.sortOrder="desc";break;case"desc":e.sortOrder="asc";break;default:e.sortOrder="asc"}n.serverSort?c():n.rows.sort(function(t,a){return"asc"==e.sortOrder?(t[e.field]+"").localeCompare(a[e.field]+""):(a[e.field]+"").localeCompare(t[e.field]+"")})},y=function(e){return n.columns=e,i(),n.columns},z=function(){g()};a.__table__=function(){return function(e,t){return r(e,t),s(),{onHeaderCheckBoxChange:h,onRowCheckBoxChange:b,gotoFirstPage:m,gotoPrePage:x,gotoNextPage:w,gotoLastPage:v,gotoSkipPage:P,changePageSize:k,reload:S,sortColumn:C,buildColumns:y,toggleColumn:z,registerDataChangeListener:f,initPage:l,context:n}}}}return a}]).directive("ourpalmTable",["$parse","ourpalmTable","$compile","$timeout",function(a,n,o,r){var l=[];return{restrict:"AE",priority:1001,scope:!0,compile:function(a,o){var r=function(a){var o=[];return t(a).find("td").each(function(a){var r=t(this),l=r.attr("table-column"),c=r.attr("header"),i=r.attr("field"),s=r.attr("sort"),u=r.attr("checkbox"),g=r.attr("sort-order"),p=r.attr("rownumbers"),d=r.attr("show");l=l?JSON.parse(l):{},s="true"===s,u="true"===u,p="true"===p,d="false"!==d;var f={},h={},b=n.options.column;return e.extend(h,l,{header:c,field:i,sort:s,checkbox:u,sortOrder:g,rownumbers:p,show:d}),e.extend(f,b,h),o.push(f),r.attr("ng-show","$columns["+a+"].show"),f.checkbox?r.html('<input type="checkbox" ng-model="$row.__checked__" ng-change="$onRowCheckBoxChange($row);" />'):f.rownumbers?r.html("{{$index + 1}}"):void 0}),o};return l=r(a),a.prepend('<ourpalm-table-header table="ourpalmTableController.table"></ourpalm-table-header>'),a.append('<ourpalm-table-pagination table="ourpalmTableController.table"></ourpalm-table-pagination>'),a.append('<ourpalm-table-set-columns table="ourpalmTableController.table"></ourpalm-table-set-columns>'),{pre:function(e,t,a,n){}}},controllerAs:"ourpalmTableController",controller:["$element","$scope","$attrs",function(t,o,c){function i(e,t,n){var r=a(c[t])(o.$parent);void 0!=r&&(n?n(r):e[t]=r)}var s=this,u=n.options,g={};i(g,"options",function(t){e.extend(g,t)}),i(g,"pagination"),i(g,"singleSelect"),i(g,"serverSort"),i(g,"pageList"),i(g,"defaultPageSize"),i(g,"skipPage"),i(g,"serverLoad"),i(g,"cacheKey"),i(g,"cachePageSize"),i(g,"cacheColumns");var p=a(c.ourpalmTable)(o.$parent);s.table=p.__table__()(u,g),l=s.table.buildColumns(l),s.table.registerDataChangeListener(function(){r(function(){o.$rows=s.table.context.rows})}),o.$onRowCheckBoxChange=s.table.onRowCheckBoxChange,o.$columns=l,s.table.initPage()}]}}]).directive("ourpalmTableHeader",function(){return{restrict:"AE",scope:{table:"="},template:'\n                    <thead>\n                        <tr>\n                            <th ng-repeat="col in table.context.columns" ng-show="col.show">\n                                <!-- 非 checkbox 列 -->  \n                                <span ng-if="col.checkbox == false" class="ourpalm-table-header-sort">\n                                    <!-- 非序号列 -->\n                                    <span ng-if="col.rownumbers == false">\n                                        <!-- 排序列 -->\n                                        <span ng-if="col.sort == true"> \n                                            <a href="javascript:void(0);" ng-hide="col.sortOrder" ng-click="table.sortColumn(col, $index);">{{col.header}}</a>\n                                            <a href="javascript:void(0);" ng-show="col.sortOrder == \'asc\'" ng-click="table.sortColumn(col, $index);">{{col.header}}<i class="fa fa-caret-down"></i></a>\n                                            <a href="javascript:void(0);" ng-show="col.sortOrder == \'desc\'" ng-click="table.sortColumn(col, $index);">{{col.header}}<i class="fa fa-caret-up"></i></a>\n                                        </span>\n                                        \n                                        <!-- 非排序列 -->\n                                        <span ng-if="col.sort == false">\n                                            {{col.header}}\n                                        </span>\n                                    </span>\n                                    \n                                    <!-- 序号列 -->\n                                    <span ng-if="col.rownumbers == true">\n                                        {{col.header}}\n                                    </span>\n                                    \n                                </span>\n                                \n                                <!-- checkbox 列 --> \n                                <span ng-if="col.checkbox == true">\n                                    <input type="checkbox" ng-model="table.context.allBoxChecked" ng-change="table.onHeaderCheckBoxChange();">\n                                </span>\n                            </th>\n                        </tr>\n                    </thead>\n                 ',replace:!0}}).directive("ourpalmTableSetColumns",function(){return{restrict:"AE",scope:{table:"="},template:'\n                    <div ng-show="table.context.setColumns">\n                        <div class="ourpalm-mask"></div>\n                        <div class="ourpalm-dialog">\n                            <div class="modal-content ourpalm-table-column">\n                                <div class="modal-header">\n                                    <button type="button" class="close" data-dismiss="modal" ng-click="table.context.setColumns = false;">\n                                        <span aria-hidden="true">×</span>\n                                    </button>\n                                    <h4 class="modal-title">自定义列表项</h4>\n                                </div>\n                                <div class="modal-body">\n                                    <label class="checkbox-inline" ng-repeat="col in table.context.columns">\n                                        <input type="checkbox" ng-model="col.show" ng-click="table.toggleColumn();">{{col.header}}\n                                    </label>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                ',replace:!0}}).directive("ourpalmTablePagination",function(){return{restrict:"AE",scope:{table:"="},template:'\n                    <tfoot>\n                        <tr ng-if="table.context.pagination">\n                            <td colspan="{{table.context.columns.length}}">\n                                <span style="float:left;">\n                                    <select ng-model="table.context.pageSize" class="form-control input-sm" ng-options="pageSize for pageSize in table.context.pageList" ng-change="table.changePageSize();" class="form-control input-sm" style="height:20px;line-height:20px;padding:0;margin-top:-2px;max-width:50px;display:inline-block;"></select>\n                                    <button class="ourpalm-table-pager" ng-disabled="table.context.currentPage == 1" ng-click="table.gotoFirstPage();"><i class="fa fa-step-backward"></i></button><!--首页-->\n                                    <button class="ourpalm-table-pager" ng-disabled="table.context.currentPage == 1" ng-click="table.gotoPrePage();"><i class="fa fa-backward"></i></button><!-- 上一页-->\n                                    第\n                                    <input type="number" ng-model="ourpalmTablePaginationController.currPage" ng-keyup="table.gotoSkipPage($event);" ng-readonly="!table.context.skipPage" min="1" max="{{table.context.allPage}}" class="form-control input-sm" style="height:20px;line-height:20px;padding:0;margin-top:-2px;max-width:34px;display:inline-block;">\n                                    页,共{{table.context.allPage}}页\n                                    <button class="ourpalm-table-pager" ng-disabled="table.context.currentPage == table.context.allPage" ng-click="table.gotoNextPage();"><i class="fa fa-forward"></i></button><!-- 下一页-->\n                                    <button class="ourpalm-table-pager" ng-disabled="table.context.currentPage == table.context.allPage" ng-click="table.gotoLastPage();"><i class="fa fa-step-forward"></i></button><!-- 尾页-->\n                                    <button class="ourpalm-table-pager" ng-click="table.reload();"><i class="fa fa-refresh"></i></button><!--刷新-->\n                                    <button class="ourpalm-table-pager" ng-click="table.context.setColumns = true;"><i class="fa fa-gear"></i></button><!--自定义列表项-->\n                                </span>\n                                <span style="float:right;">显示{{(table.context.currentPage - 1) * table.context.pageSize + 1}} / {{(table.context.currentPage * table.context.pageSize > table.context.total ? table.context.total : (table.context.currentPage * table.context.pageSize))}}条记录 ，共{{table.context.total}}条记录</span>\n                            </td>\n                        </tr>\n                    </tfoot>\n                ',replace:!0,link:function(e,t,a,n){e.$watch(function(){return e.table.context.currentPage},function(t){e.currPage=t})},controllerAs:"ourpalmTablePaginationController",controller:["$scope",function(e){var t=this;e.$watch(function(){return e.table.context.currentPage},function(e){t.currPage=e})}]}})}(angular,jQuery)},function(e,t){}]);